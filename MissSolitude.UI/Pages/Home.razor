@page "/"
@using MissSolitude.Contracts
@inject HttpClient HttpClient

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

@if (_error is not null)
{
    <p style="color:red">@_error</p>
}
else if (_user is null)
{
    <p>Loading...</p>
}
else
{
    <table>
        <thead>
        <tr><th>Name</th></tr>
        <tr><th>Email</th></tr>
        </thead>
        <tbody>
        <tr>
            <td>@_user.Username</td>
            <td>@_user.Email</td>
        </tr>
        </tbody>
    </table>
}

@code
{
    private UserDto? _user;
    private string? _error;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var id = Guid.Parse("3924ff82-194a-490e-afe0-5a5b9c3063df");
            _user = await HttpClient.GetFromJsonAsync<UserDto>($"api/User/{id}");
        }
        catch (HttpRequestException exception)
        {
            _error = $"Request failed: {exception.Message}";
        }
        catch (FormatException)
        {
            _error = "Invalid GUID string.";
        }
        catch (NotSupportedException exception)
        {
            _error = $"Response format error: {exception.Message}";
        }
    }
}